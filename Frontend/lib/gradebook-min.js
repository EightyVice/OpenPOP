"use strict";(function(f){var d=ODSA.SETTINGS,k=ODSA.UTILS;var i=ODSA.MOD.STATUS;var c=300;var h={};function l(q,p){if(d.DEBUG_MODE){console.group("generateModule("+q+", modExercises)");console.debug(JSON.stringify(p))}var r=0,t=0,o="";if(Object.keys(p).length===0){o="There are no exercises in this section"}else{var n=-1;o='<table id="'+q+'-exercises" class="data" width="90%">';o+='<tr class="header"><th>Exercises</th><th class="score">Points</th></tr>';for(var s in p){if(p.hasOwnProperty(s)&&typeof p[s].points!=="undefined"){n=Math.round(parseFloat(p[s].points)*100)/100;t+=n;o+='<tr id="'+s+'"';if(n===0){o+=' class="zeroPointExer"'}o+='><td><a href="'+q+".html#"+s+'_exer">'+p[s].long_name+"</a></td>";if(ODSA.MOD.getProficiencyStatus(s)===i.STORED){r+=n;o+='<td class="score proficient">'+n.toFixed(2)}else{o+='<td class="score">0.00'}o+=" / "+n.toFixed(2)+"</td></tr>"}}o+='<tr class="header"><th><span>Total</span></th><th class="score">'+r.toFixed(2)+" / "+t.toFixed(2)+"</th></tr></table>";if(n===-1){o="There are no exercises in this section"}}if(d.DEBUG_MODE){console.groupEnd()}return{userTotal:r,total:t,html:o}}function e(p,v,q){if(d.DEBUG_MODE){console.group("generateSection(secData, "+q+")");console.debug(JSON.stringify(p))}var s=0,o=0,y=0,r,z,u='<table width="100%">';for(var t in p){if(p.hasOwnProperty(t)){s++;var w=(v==="")?v+(s-1):v+"."+s;var x=t.slice(t.lastIndexOf("/")+1).replace(".rst","");if(p[t].exercises){r=l(x,p[t].exercises)}else{r=e(p[t],w,q+1);if(r.total===0){continue}}o+=r.userTotal;y+=r.total;var n=w.replace(/\./g,"")+"-"+t.replace(/\//g,"");n=n.replace(/\s/g,"_");u+='<tr><td class="section-header" data-sec-name="'+n+'">'+w+" ";u+=((p[t].exercises&&p[t].long_name)?p[t].long_name:t)+"</td>";u+=(ODSA.MOD.getProficiencyStatus(x)===i.STORED)?'<td class="score proficient">':'<td class="score">';u+=r.userTotal.toFixed(2)+" / "+r.total.toFixed(2)+"</td></tr>";u+='<tr id="'+n+'" class="gb-section-container"><td colspan="2" style="padding-left: 20px">';u+=r.html;u+="</td></tr>"}}u+="</table>";if(d.DEBUG_MODE){console.groupEnd()}return{userTotal:o,total:y,html:u}}function b(){f("#loadingMessage").hide();f("#gradeHeader").show();var o=e(h,"",0);var n=o.html;n=n.slice(n.indexOf("<tr"),n.lastIndexOf("</table"));n='<table class="data" width="70%"><tr><th>Chapter</th><th class="score">Score</th></tr>'+n;n+='<tr class="header"><th>Total</th><th class="score">'+o.userTotal.toFixed(2)+" / "+o.total.toFixed(2)+"</th></tr></table>";f("#gradeData").append(n);f(".zeroPointExer").hide();f("#showZeroPointExer").removeAttr("checked");f(".section-header").addClass("expandImage");f(".section-header").each(function(p,q){f(this).click(function(t){var s=f(t.target).data("sec-name");if(s){var r=f("#"+s);if(f(this).hasClass("expandImage")){r.show(c);f(this).removeClass("expandImage");f(this).addClass("collapseImage")}else{r.hide(c);f(this).removeClass("collapseImage");f(this).addClass("expandImage")}}})})}function j(){if(d.DEBUG_MODE){console.group("loadGradebook()");console.debug("book: "+d.BOOK_NAME)}f("#gradeData").html("");f("#gradeHeader").hide();f("#loadingMessage").show();if(k.serverEnabled()&&k.userLoggedIn()){ODSA.MOD.syncProficiency()}else{b()}if(d.DEBUG_MODE){console.groupEnd()}}function a(){f("#loadingMessage").hide();f("#gradeData").replaceWith('<div class="error">The server did not respond.  Please try again later.</div>')}function m(){f(".gb-section-container").show(c);f(".section-header").removeClass("expandImage");f(".section-header").addClass("collapseImage")}function g(){f(".gb-section-container").hide(c);f(".section-header").addClass("expandImage");f(".section-header").removeClass("collapseImage")}f(document).ready(function(){f.getJSON(location.href.substring(0,location.href.lastIndexOf("/"))+"/_static/"+d.BOOK_NAME+".json",function(n){h=n.chapters;j()});f("body").on("gradebook-load",function(o,n){j()});f("body").on("gradebook-gen-table",function(o,n){b()});f("body").on("gradebook-error",function(o,n){b()});f("#expand").click(function(){m();return false});f("#collapse").click(function(){g();return false});f("#showZeroPointExer").change(function(){if(this.checked){f(".zeroPointExer").show(c);k.logUserAction("odsa-gradebook-show-zpe","")}else{f(".zeroPointExer").hide(c);k.logUserAction("odsa-gradebook-hide-zpe","")}return false})})}(jQuery));