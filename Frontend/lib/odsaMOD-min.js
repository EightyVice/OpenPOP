"use strict";(function(h){var z=ODSA.SETTINGS,C=ODSA.UTILS;z.DISP_MOD_COMP=false;var r=z.MODULE_NAME;var y={};var p={SUBMITTED:"SUBMITTED",STORED:"STORED",ERROR:"ERROR"};var E=+new Date();String.prototype.endsWith=function(I){return this.indexOf(I,this.length-I.length)!==-1};function A(){var I=-1;h.ajax({url:"modules.json",async:false,dataType:"json",success:function(J){h.each(J,function(K,L){if(L.fields.short_display_name.toLowerCase()===r.toLowerCase()){alert(r+"\nModule Written by "+L.fields.author+" \nCreated as part of the OpenDSA hypertextbook project.\nFor more information, see http://algoviz.org/OpenDSA\nFile created: "+L.fields.last_modified+"\nJSAV library version "+JSAV.version()+"\nDistributed under the MIT open-source license,\nsee http://algoviz.org/OpenDSA/MIT-license.txt");I=1}})}});if(I===-1){alert(r+" \nCreated as part of the OpenDSA hypertextbook project.\nFor more information, see http://algoviz.org/OpenDSA\nJSAV library version "+JSAV.version())}}function q(L,I){var J=new Date();J.setDate(J.getDate()+5);var K={};K.username=L;K.key=I;K.expires=J;localStorage.session=JSON.stringify(K)}function i(){if(localStorage.session){var K=JSON.parse(localStorage.session),J=K.expires,I=new Date();return J<=I}return true}function a(J){console.warn("Sesson expired");var I=C.getSessionKey();if(J===I){localStorage.removeItem("session");localStorage.removeItem("warn_login");alert("Your account has been logged in on another computer and the\n current session is no longer valid. Please login again to continue.");window.location.reload()}}function G(N){var K=h("#"+N),J=N.replace("_showhide_btn",""),O=h("#"+J);if(O.length>0){if(O.is(":visible")){O.hide();K.val(K.val().replace("Hide","Show"));return}else{O.show()}}else{var M=K.data("frame-src"),L=K.data("frame-width"),I=K.data("frame-height");K.after('<div id="'+J+'"><p></p><center><iframe id="'+J+'_iframe" data-av="'+J+'" src="'+M+'" type="text/javascript" width="'+L+'" height="'+I+'" frameborder="0" marginwidth="0" marginheight="0" scrolling="no">\n</iframe></center></div>')}K.val(K.val().replace("Show","Hide"));if(C.serverEnabled()&&!C.userLoggedIn()){x()}}function d(J,L,I){if(localStorage.proficiency_data){L=(L)?L:C.getUsername();I=(I)?I:z.BOOK_NAME;var K=C.getJSON(localStorage.proficiency_data);if(K[L]&&K[L][I]&&K[L][I][J]){return K[L][I][J]}}return false}function w(K,I,M,J){if(z.DEBUG_MODE){console.group("storeProficiencyStatus("+K+", "+I+", "+M+", "+J+")")}if(K===r&&!z.DISP_MOD_COMP){if(z.DEBUG_MODE){console.debug(K+" cannot be completed");console.groupEnd()}return}I=(typeof I!=="undefined")?I:p.STORED;M=(M)?M:C.getUsername();J=(J)?J:z.BOOK_NAME;var L=C.getJSON(localStorage.proficiency_data);if(z.DEBUG_MODE){console.debug("storeProficiencyStatus("+K+", "+I+", "+M+", "+J+")");console.debug("profData (unmodified):");console.debug(JSON.stringify(L))}if(!L[M]){if(z.DEBUG_MODE){console.debug("Creating new proficiency_data entry for "+M)}L[M]={}}if(!L[M][J]){if(z.DEBUG_MODE){console.debug("Creating new book entry for "+M)}L[M][J]={}}if(I){L[M][J][K]=I}else{delete L[M][J][K]}localStorage.proficiency_data=JSON.stringify(L);if(z.DEBUG_MODE){console.debug("profData (modified):");console.debug(JSON.stringify(L));console.groupEnd()}}function D(I){I=(I)?I:r;if(z.DEBUG_MODE){console.group("updateProfDisplay("+I+")")}var O=C.getUsername(),N=d(I,O,z.BOOK_NAME);if(y[I]){if(z.DEBUG_MODE){console.debug("Updating exercise proficiency")}var P=h("#"+I+"_cm_saving_msg"),Q=h("#"+I+"_cm_error_msg"),K=h("#"+I+"_check_mark");if(K.length>0){K.hide();P.hide();Q.hide();if(N===p.SUBMITTED){K.show();P.show()}else{if(N===p.ERROR){K.show();Q.show()}else{if(N===p.STORED){K.show()}}}}var L=h("#"+I+"_showhide_btn");if(L.length>0){P=h("#"+I+"_shb_saving_msg");Q=h("#"+I+"_shb_error_msg");P.hide();Q.hide();if(N===p.SUBMITTED){L.css("background-color","#FFFF00");P.show()}else{if(N===p.ERROR){L.css("background-color","#FFFF00");Q.show()}else{if(N===p.STORED){L.css("background-color","lime")}else{L.css("background-color","#FF0000")}}}}}else{if(z.DEBUG_MODE){console.debug("Updating module proficiency")}var M="#"+I+"_complete";if(h(M).length>0){if(N===p.SUBMITTED||N===p.ERROR){h(M).show();h(M).css("color","#FFFF00")}else{if(N===p.STORED){h(M).show();h(M).css("color","lime")}else{h(M).hide()}}}if(h('li.toctree-l1 > a.reference.internal[href="'+I+'.html"]').length>0){var J=(N===p.STORED)?"url(_static/Images/small_check_mark_green.gif)":"";h('li.toctree-l1 > a.reference.internal[href="'+I+'.html"]').parent().css("list-style-image",J)}}if(z.DEBUG_MODE){console.debug("returning: "+N);console.groupEnd()}return N}function b(L,P,K){L=(L)?L:r;P=(P)?P:C.getUsername();K=(K)?K:z.BOOK_NAME;if(z.DEBUG_MODE){console.group("checkProficiency("+L+", "+P+", "+K+")")}var I=D(L);if(I===p.STORED){if(z.DEBUG_MODE){console.debug("Cached status: "+I);console.groupEnd()}return}if(C.serverEnabled()&&C.userLoggedIn()){var N={},J;N.key=C.getSessionKey();N.book=K;if(y[L]){if(z.DEBUG_MODE){console.debug("Querying server for exercise proficiency for "+P)}N.exercise=L;J="/api/v1/userdata/isproficient/"}else{if(z.DEBUG_MODE){console.debug("Querying server for module proficiency for "+P)}N.module=L;J="/api/v1/usermodule/ismoduleproficient/"}jQuery.ajax({url:z.SERVER_URL+J,type:"POST",data:N,contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(Q){Q=C.getJSON(Q);if(z.DEBUG_MODE){console.group("Server response, checkProficiency("+L+", "+P+")");console.debug(JSON.stringify(Q))}if(Q.proficient){k(L,p.STORED,P)}if(z.DEBUG_MODE){console.groupEnd()}},error:function(Q){Q=C.getJSON(Q);if(Q.status===401){a(N.key)}else{if(Q.status===404){console.warn(L+" does not exist in the database")}else{console.group("Error: checkProficiency("+L+", "+P+")");console.debug("Error checking proficiency: "+L);console.debug(JSON.stringify(Q));console.groupEnd()}}}})}else{if(L===r){if(z.DEBUG_MODE){console.debug("Determining (client-side) module proficiency for guest")}I=p.STORED;var O;for(var M in y){if(y.hasOwnProperty(M)&&y[M].required){O=d(M,P,z.BOOK_NAME);if(!O){if(z.DEBUG_MODE){console.debug(M+": false")}I=false;break}else{if(O!==p.STORED){I=O}}if(z.DEBUG_MODE){console.debug(M+": "+O)}}}if(I){k(L,I,P)}else{if(z.DEBUG_MODE){console.debug(L+": false")}}}}if(z.DEBUG_MODE){console.groupEnd()}}function k(J,I,K){K=(K)?K:C.getUsername();if(z.DEBUG_MODE){console.group("storeStatusAndUpdateDisplays("+J+" , "+I+", "+K+")")}w(J,I,K);D(J);if(y[J]&&y[J].required&&I===p.STORED){b(r)}if(z.DEBUG_MODE){console.groupEnd()}}function g(){if(C.serverEnabled()&&C.userLoggedIn()){var J=C.getUsername(),I=C.getSessionKey();jQuery.ajax({url:z.SERVER_URL+"/api/v1/userdata/getgrade/",type:"POST",data:{key:I,book:z.BOOK_NAME},contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(M){M=C.getJSON(M);if(z.DEBUG_MODE){console.group("Server response, syncProficiency()");console.debug(JSON.stringify(M))}if(M.grades&&M.modules){var L,N,K;for(L=0;L<M.grades.length;L++){N=M.grades[L];w(N.exercise,(N.points>0)?p.STORED:false,J);D(N.exercise)}for(L=0;L<M.modules.length;L++){K=M.modules[L];w(K.module,(K.proficient)?p.STORED:false,J);D(K.module)}h("body").trigger("gradebook-gen-table");if(z.DEBUG_MODE){console.debug("localStorage.proficiency_data:");console.debug(localStorage.proficiency_data)}}else{h("body").trigger("gradebook-error")}if(z.DEBUG_MODE){console.groupEnd()}},error:function(K){K=C.getJSON(K);if(K.status===404){h("body").trigger("gradebook-gen-table")}else{h("body").trigger("gradebook-error");if(K.status===401){a(I)}else{console.debug("Error getting user's points");console.debug(JSON.stringify(K))}}}})}}function o(K){K=(K)?K:r;if(z.DEBUG_MODE){console.group("loadModule("+K+")")}if(K==="Gradebook"){h("body").trigger("gradebook-load")}var J;if(C.serverEnabled()&&C.userLoggedIn()){if(K==="index"){g()}if(z.DEBUG_MODE){console.debug("Querying server for module data")}var N=C.getUsername(),I={},M={},L=[];for(J in y){if(y.hasOwnProperty(J)){D(J);M=h.extend(true,{},y[J]);M.exercise=J;delete M.uiid;L.push(M)}}I.key=C.getSessionKey();I.book=z.BOOK_NAME;I.url=location.href.substring(0,location.href.lastIndexOf("/")+1);I.module=K;I.completable=z.DISP_MOD_COMP;if(K==="index"){I.name="Contents"}else{I.name=document.title.slice(document.title.indexOf(" ")+1,document.title.indexOf("\u2014")-1)}I.exercises=JSON.stringify(L);if(z.DEBUG_MODE){console.debug("Sending modData:");console.debug(JSON.stringify(I))}jQuery.ajax({url:z.SERVER_URL+"/api/v1/module/loadmodule/",type:"POST",data:I,contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(P){P=C.getJSON(P);if(z.DEBUG_MODE){console.group("Server response, loadModule("+K+", "+N+")");console.debug(JSON.stringify(P))}for(var O in P){if(P.hasOwnProperty(O)){if(y[O]){w(O,(P[O].proficient)?p.STORED:false,N);D(O);if(y[O].type==="ka"&&P[O].progress){y[O].progress=P[O].progress;M=C.getJSON(localStorage.khan_exercise);M[O]=y[O].progress;localStorage.khan_exercise=JSON.stringify(M)}}else{w(O,(P[O])?p.STORED:false,N);D(O)}}}if(z.DEBUG_MODE){console.groupEnd()}},error:function(O){O=C.getJSON(O);console.group("Error loading module: "+K);console.debug(JSON.stringify(O));console.groupEnd();if(O.status===401){a(I.key)}}})}else{if(K==="index"){h("li.toctree-l1 > a.reference.internal").each(function(O,P){if(h(P).attr("href").endsWith(".html")){K=C.getNameFromURL(h(P).attr("href"));if(z.DISP_MOD_COMP){D(K)}}})}else{if(z.DEBUG_MODE){console.debug("Load guest data from localStorage")}for(J in y){if(y.hasOwnProperty(J)){D(J)}}b(r)}}if(z.DEBUG_MODE){console.groupEnd()}}function u(L,K,J){K=(K)?K:C.getUsername();J=(J)?J:z.BOOK_NAME;if(C.serverEnabled()&&(z.ALLOW_ANON_CREDIT||C.userLoggedIn())){if(z.DEBUG_MODE){console.group("storeScoreData("+JSON.stringify(L)+", "+K+", "+J+")")}if(C.serverEnabled()){var I=C.getJSON(localStorage.score_data);if(z.DEBUG_MODE){console.debug("Storing exercise score for "+K);console.debug("scoreData (unmodified):");console.debug(JSON.stringify(I))}if(!I[K]){if(z.DEBUG_MODE){console.debug("Creating a new score_data entry for "+K)}I[K]={}}if(!I[K][J]){if(z.DEBUG_MODE){console.debug("Creating a new book entry for "+K)}I[K][J]=[]}I[K][J].push(L);localStorage.score_data=JSON.stringify(I);if(z.DEBUG_MODE){console.debug("scoreData (modified):");console.debug(JSON.stringify(I))}}if(z.DEBUG_MODE){console.groupEnd()}}}function m(N,K){if(z.ALLOW_ANON_CREDIT){N=(N)?N:C.getUsername();K=(K)?K:z.BOOK_NAME;if(N==="guest"){return}var I=C.getJSON(localStorage.score_data);if(!I.guest||!I.guest[K]){return}if(z.DEBUG_MODE){console.group("assignAnonScoreData("+N+", "+K+")");console.debug("scoreData (unmodified):");console.debug(JSON.stringify(I))}var M=h.extend(true,[],I.guest[K]);delete I.guest[K];localStorage.score_data=JSON.stringify(I);var J=new Date();J.setDate(J.getDate()-5);if(z.DEBUG_MODE){console.debug("anonData:");console.debug(JSON.stringify(M))}for(var L=0;L<M.length;L++){if(z.DEBUG_MODE){console.debug(M[L].tstamp+" > "+(+J))}if(M[L].tstamp>+J){u(M[L],N,K)}}if(z.DEBUG_MODE){console.debug("scoreData (modified):");console.debug(localStorage.score_data);console.groupEnd()}}}function e(K,M,J,N,I){N=(N)?N:C.getUsername();I=(I)?I:z.BOOK_NAME;if(z.DEBUG_MODE){console.group("storeExerciseScore("+K+", "+M+", "+J+", "+N+", "+I+")")}if(!y[K]){console.warn("storeExerciseScore("+K+", "+M+", "+J+", "+N+", "+I+"): invalid reference "+K);if(z.DEBUG_MODE){console.groupEnd()}return}if(C.serverEnabled()&&(z.ALLOW_ANON_CREDIT||C.userLoggedIn())){var L={};L.exercise=K;L.module=r;L.tstamp=(new Date()).getTime();L.score=M;L.total_time=J;L.uiid=y[K].uiid;if(z.DEBUG_MODE){console.debug("Storing exercise score for "+N);console.debug("data:");console.debug(JSON.stringify(L))}u(L,N,I)}if(M>=y[K].threshold&&(!C.serverEnabled()||!C.userLoggedIn())){if(z.DEBUG_MODE){console.debug("Award anonymous user proficiency")}k(K,p.STORED,N)}if(z.DEBUG_MODE){console.groupEnd()}}function B(L,M,J,K){if(z.DEBUG_MODE){console.group("sendExerciseScore(exerData, "+M+", "+J+")");console.debug(JSON.stringify(L))}if(C.serverEnabled()){if(!L){console.warn("Invalid exercise data: "+JSON.stringify(L));if(z.DEBUG_MODE){console.groupEnd()}return}J=(J)?J:C.getSessionKey();M=(M)?M:C.getUsername();K=(K)?K:z.BOOK_NAME;if(z.DEBUG_MODE){console.debug("sendExerciseScore(exerData, "+M+", "+J+", "+K+")")}if(M==="guest"){x();if(z.DEBUG_MODE){console.debug("No user is logged in");console.groupEnd()}return}var I=false;if(d(L.exercise,M,K)===p.STORED){I=true}else{if(L.score>=y[L.exercise].threshold){k(L.exercise,p.SUBMITTED,M)}}L.key=J;L.book=K;if(z.DEBUG_MODE){console.debug("Sending exerData:");console.debug(JSON.stringify(L))}jQuery.ajax({url:z.SERVER_URL+"/api/v1/user/exercise/attemptpe/",type:"POST",data:L,contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(N){N=C.getJSON(N);if(z.DEBUG_MODE){console.group("Server response, sendExerciseScore(exerData, "+M+", "+J+")");console.debug(JSON.stringify(N))}if(N.success){if(N.proficient){if(!I){k(L.exercise,p.STORED,M)}}else{k(L.exercise,false,M)}}else{if(!I){k(L.exercise,p.ERROR,M)}}if(z.DEBUG_MODE){console.groupEnd()}},error:function(O){O=C.getJSON(O);if(z.DEBUG_MODE){console.group("Error: sendExerciseScore(exerData, "+M+", "+J+", "+K+")");console.debug(JSON.stringify(O))}if(!I){k(L.exercise,p.ERROR,M)}if(O.status===400){console.debug("Score rejected by server: "+L.exercise+" for "+M);console.debug(JSON.stringify(O))}else{var N=L.key;delete L.key;delete L.book;u(L,M,K);if(O.status===401){a(N)}else{if(O.status===404){console.warn("Exercise does not exist in the database")}else{console.debug("Error sending exercise score: "+L.exercise+" for "+M);console.debug(JSON.stringify(O))}}}if(z.DEBUG_MODE){console.groupEnd()}}})}if(z.DEBUG_MODE){console.groupEnd()}}function j(N,J,L){if(z.DEBUG_MODE){console.group("sendExerciseScores("+N+", "+J+")")}if(C.serverEnabled()&&C.userLoggedIn()&&localStorage.score_data){N=(N)?N:C.getUsername();J=(J)?J:C.getSessionKey();L=(L)?L:z.BOOK_NAME;var K=C.getJSON(localStorage.score_data);if(K[N]&&K[N][L]){var I=h.extend(true,[],K[N][L]);if(z.DEBUG_MODE){console.debug("sendExerciseScores("+N+", "+J+", "+L+")");console.debug("scoreData:");console.debug(JSON.stringify(K));console.debug("userData:");console.debug(JSON.stringify(I))}delete K[N][L];localStorage.score_data=JSON.stringify(K);for(var M=0;M<I.length;M++){B(I[M],N,J,L)}}}if(z.DEBUG_MODE){console.groupEnd()}}function v(){if(z.DEBUG_MODE){console.group("flushStoredData()")}if(C.serverEnabled()){j();C.sendEventData()}if(z.DEBUG_MODE){console.groupEnd()}}function H(L){if(z.DEBUG_MODE){console.group("processEventData(data)");console.debug(JSON.stringify(L))}var I=false,K=["jsav-init","jsav-recorded","jsav-exercise-model-init","jsav-exercise-model-recorded"],M=["jsav-forward","jsav-backward","jsav-begin","jsav-end","jsav-exercise-model-forward","jsav-exercise-model-backward","jsav-exercise-model-begin","jsav-exercise-model-end"];if(K.indexOf(L.type)>-1){return}L.av=L.av.replace("_avc","");if(!L.uiid&&y[L.av]){L.uiid=y[L.av].uiid}if(!L.desc||L.desc===""){L.desc=L.type}var N,J;if(M.indexOf(L.type)>-1){L.desc=L.currentStep+" / "+L.totalSteps;if(!y[L.av].startTime){y[L.av].startTime=+new Date()}if(L.type==="jsav-forward"&&L.currentStep===L.totalSteps){if(!L.totalTime){L.totalTime=+new Date()-y[L.av].startTime;delete y[L.av].startTime}if(L.totalTime>0){e(L.av,1,L.totalTime);D(L.av);I=true}}}else{if(L.type==="jsav-array-click"){L.desc=JSON.stringify({index:L.index,arrayid:L.arrayid})}else{if(L.type==="jsav-exercise-grade-change"){N=C.roundPercent((L.score.student-L.score.fix)/L.score.total);J=C.roundPercent(L.score.student/L.score.total);L.desc=JSON.stringify({score:N,complete:J});if(J===1){e(L.av,N,L.totalTime);D(L.av);I=true}}else{if(L.type==="odsa-award-credit"){e(L.av,1,L.totalTime);D(L.av);I=true}}}}if(C.serverEnabled()){if(!L.logged){delete L.logged;C.logEvent(L)}if(I){v()}}if(z.DEBUG_MODE){console.groupEnd()}}function f(){if(C.serverEnabled()){C.logUserAction("registration-box-open","registration box was opened");var J="#registration-box",I=(h(J).width()+24)/2;h(J).css({"margin-left":-I});h("#register_error").slideUp().html("");h(J).fadeIn(300);h("body").append('<div id="mask"></div>');h("#mask").fadeIn(300);h("#user").focus()}}function c(){if(C.serverEnabled()){C.logUserAction("login-box-open","Login box was opened");var J="#login-box",K=localStorage.name,I=(h(J).width()+24)/2;if(K){h("#username").attr("value",K)}h(J).fadeIn(300);h(J).css({"margin-left":-I});h("body").append('<div id="mask"></div>');h("#mask").fadeIn(300);h("#username").focus()}}function F(){return(h("#login-box").is(":visible")||h("#registration-box").is(":visible"))}function t(){if(h("#login-box").is(":visible")){C.logUserAction("login-box-close","Login box was closed")}else{if(h("#registration-box").is(":visible")){C.logUserAction("registration-box-close","Registration box was closed")}}h("#mask , .login-popup, .registration-popup").fadeOut(300,function(){h("#mask").remove()});return false}function x(){if(C.serverEnabled()&&(!localStorage.warn_login||localStorage.warn_login!=="false")){C.logUserAction("login-warn-message","User warned they must login to receive credit");alert("You must be logged in to receive credit");localStorage.warn_login="false"}}function n(J,I){jQuery.ajax({url:z.SERVER_URL+"/api/v1/users/login/",type:"POST",data:{username:J,password:I},contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(K){K=C.getJSON(K);if(z.DEBUG_MODE){console.group("User logged in")}if(K.success){q(J,K.key);localStorage.name=J;C.logUserAction("user-login","User logged in");m(J);l()}if(z.DEBUG_MODE){console.groupEnd()}},error:function(K){K=C.getJSON(K);console.group("Error logging in");console.debug(K);console.groupEnd();if(K.status===401){alert("Incorrect username / password combination")}else{if(K.status===403){alert("This account has been disabled")}else{if(K.status===0){alert("Login failed because the server is not responding or is not reachable.\nFor help, please contact the OpenDSA team.");localStorage.warn_login=true;t()}else{alert("Login failed");localStorage.warn_login=true;t()}}}}})}function l(){if(z.DEBUG_MODE){console.group("updateLogin()")}if(C.serverEnabled()){var J=C.getUsername(),I=false;if(localStorage.session&&h("a.username-link").text()!==J){if(z.DEBUG_MODE){console.debug(J+" has logged in since the last page refresh, update the page")}I=true;h("#login-link").text("Logout");h("a.username-link").text(J);h("a.username-link").show();h("#registration-link").hide();if(F()){t()}v()}else{if(!localStorage.session&&h("#login-link").text()!=="Login"){if(z.DEBUG_MODE){console.debug(h("#login-link").text()+" has logged out since the last page refresh, update the page")}I=true;h("#login-link").text("Login");h("a.username-link").text("");h("a.username-link").hide();h("#registration-link").show();localStorage.removeItem("warn_login");localStorage.removeItem("khan_exercise")}}if(I){o()}}if(z.DEBUG_MODE){console.groupEnd()}}h(document).ready(function(){var N="czSpsiM@Ei.ZT.Ssv",Q="81fRgEkPiQjWvw4aTnyq5IKJCX3xeZ0HMoprdUGA2NbYFSlh7mcz6sDBVuOL9t",I=N.length,O="";for(var K=0;K<N.length;K++){if(Q.indexOf(N.charAt(K))===-1){O+=N.charAt(K)}else{O+=Q.charAt((Q.indexOf(N.charAt(K))-I+Q.length)%Q.length)}}var P="../../../lib/";h("script").each(function(S,T){if(h(T).attr("src")&&h(T).attr("src").indexOf("/lib/odsaMOD")>-1){P=h(T).attr("src");P=P.slice(0,P.indexOf("odsaMOD"))}});h(".email_div").append('<a id="contact_us" class="contact" style="float:left;color:blue;" rel="nofollow" href="mailto:'+O+'">Contact Us |</a><a style="float:left;color:blue;" rel="nofollow" href="'+P+'Privacy.html" target="_blank">| Privacy</a>');h(".showHideLink, iframe, .ssAV").each(function(S,U){var T=h(U).data("exer-name"),V={};if(y[T]){return}V.name=h(U).data("long-name");V.points=h(U).data("points");V.required=(h(U).data("required")==="True");V.threshold=h(U).data("threshold");V.type=h(U).data("type");V.uiid=+new Date();y[T]=V;if(h(U).hasClass("showHideLink")){h(U).after("<span id='"+T+"_shb_error_msg' class='shb_msg'><img src='_static/Images/warning.png' class='shb_warning_icon' /> Server Error <a class='resubmit_link' href='#'>Resubmit</a></span>");h(U).after("<span id='"+T+"_shb_saving_msg' class='shb_msg'>Saving...</span>")}});for(var L in y){if(y.hasOwnProperty(L)&&y[L].required){z.DISP_MOD_COMP=true;break}}if(z.DISP_MOD_COMP){h("h1 > a.headerlink").parent().css("position","relative");h("h1 > a.headerlink").parent().append('<div id="'+r+'_complete" class="mod_complete">Module Complete</div>')}h("body").on("jsav-log-event",function(T,S){H(S)});h("body").on("odsa-session-expired",function(T,S){a(S.key)});var R=window.addEventListener?"addEventListener":"attachEvent",M=window[R],J=(R==="attachEvent")?"onmessage":"message";M(J,function(T){if(T.origin!==z.EXERCISE_ORIGIN&&T.origin!==z.AV_ORIGIN){return}var S=C.getJSON(T.data);if(S.exercise&&S.proficient){k(S.exercise,p.STORED,C.getUsername())}else{y[S.av].uiid=S.uiid;H(S)}},false);if(C.serverEnabled()){C.logUserAction("document-ready","User loaded the "+r+" module page");if(i()){v();localStorage.removeItem("session");if(!localStorage.warn_login){c()}o()}else{l()}h(window).focus(function(S){l();C.logUserAction("window-focus","User looking at "+r+" window")});h(window).blur(function(S){C.logUserAction("window-blur","User is no longer looking at "+r+" window")});h(window).on("beforeunload",function(){C.logUserAction("window-unload","User closed or refreshed "+r+" window")});h(".resubmit_link").click(function(S){v();return false});h("#login-submit-button").click(function(T){var U=h("#username").val(),S=h("#password").val();if(U===""||S===""){alert("Please enter your username and password");return false}n(U,S);return false});h("#login-link").click(function(){if(h("#login-link").text()==="Login"){c();return false}else{v();jQuery.ajax({url:z.SERVER_URL+"/api/v1/users/logout/",type:"GET",data:{key:C.getSessionKey()},contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(S){S=C.getJSON(S)},error:function(S){S=C.getJSON(S);console.group("Error logging out");console.debug(S);console.groupEnd()}});C.logUserAction("user-logout","User logged out");localStorage.removeItem("session");window.location.reload()}});h("#register-button").click(function(){h(".login-popup").fadeOut(300);f();return false});h("#forgot").click(function(){window.open(z.SERVER_URL+"/accounts/password/reset/")});h("#registration-link").click(function(){f();return false});h("#register-submit-button").click(function(){var S=h("#user").val();var V=h("#pass").val();var W=h("#rpass").val();var T=h("#email").val();if(S===""){h("#register_error").slideDown().html("Please enter a username");return false}if(V===""){h("#register_error").slideDown().html("Please enter a password");return false}if(W===""){h("#register_error").slideDown().html("Please confirm your password");return false}if(V!==W){h("#register_error").slideDown().html("Passwords do not match");return false}var U=/^([^<>()\[\]\\.,;:\s@\"]+(\.[^<>()\[\]\\.,;:\s@\"]+)*)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(!U.test(T)){h("#register_error").slideDown().html("Please enter a valid email");return false}jQuery.ajax({url:z.SERVER_URL+"/api/v1/newuser/",type:"POST",data:JSON.stringify({username:S,password:V,email:T}),processData:false,contentType:"application/json; charset=utf-8",datatype:"json",xhrFields:{withCredentials:true},success:function(X){n(S,V);t()},error:function(X){X=C.getJSON(X);if(X.status===400){h("#register_error").slideDown().html("Username already exists")}}});return false});h("a.close, #mask").live("click",function(){x();t()})}else{h("#login-link").hide();h("#registration-link").hide();o()}h("input.showHideLink").click(function(S){var T=S.target.id;G(T)});h("a.abt").click(function(S){A()})});h(window).load(function(){console.debug("Load time: "+(+new Date()-E))});var s={};s.STATUS=p;s.getProficiencyStatus=d;s.syncProficiency=g;window.ODSA.MOD=s}(jQuery));